import{r as N,j as e,a as C,R as D}from"./vendor-react-cSbnrvtP.js";import{_ as P,u as F,a as _}from"./index-DEjusOMA.js";const A=(a,n)=>n;function H(a){return a?new Date(a).toLocaleDateString():A("stats-na","N/A")}function U(a){if(a==null)return A("stats-na","N/A");let n=Math.floor(a/1e3),r=Math.floor(n/60),y=Math.floor(r/60);return n%=60,r%=60,`${y>0?y+"h ":""}${r>0?r+"m ":""}${n}s`.trim()}function L(a){return!a||a.length!==32?a||"N/A":`${a.substring(0,8)}-${a.substring(8,12)}-${a.substring(12,16)}-${a.substring(16,20)}-${a.substring(20)}`}async function I(a){try{const n=await fetch(`https://api.ashcon.app/mojang/v2/user/${encodeURIComponent(a)}`);if(!n.ok)return null;const r=await n.json();if(r&&r.uuid&&r.username)return{uuid:r.uuid.replace(/-/g,""),name:r.username}}catch{}return null}async function q(a){const n=a.replace(/-/g,""),r="https://corsproxy.io/?",y=`https://sessionserver.mojang.com/session/minecraft/profile/${n}`;try{const u=await fetch(`${r}${y}`);if(!u.ok)return null;const g=await u.json();if(g&&g.name)return{name:g.name}}catch{}return null}function T(a){return a?`https://crafatar.com/skins/${a.replace(/-/g,"")}?default=MHF_Steve`:"img/player-skin.png"}async function V(a){return null}function W(a){const[n,r]=N.useState(""),[y,u]=N.useState(!1),[g,w]=N.useState(null),[p,b]=N.useState(null),[f,v]=N.useState(!1),l=N.useRef(null),j=N.useRef(null),t=N.useCallback(async o=>{const d=(o??"").trim();if(!d){w("empty"),b(null);return}u(!0),w(null),v(!1);try{let k=await V(d);if(k&&k.uuid){b({...k,skinUrl:T(k.uuid)});return}let i=null,c=d;const s=d.replace(/-/g,"");if(/^[0-9a-fA-F]{32}$/.test(s)){i=s;const m=await q(i);m!=null&&m.name&&(c=m.name)}else{const m=await I(d);m&&(i=m.uuid,c=m.name)}if(!i||!/^[0-9a-fA-F]{32}$/.test(i)){w("notfound"),b(null);return}const h={uuid:i,displayName:c,role:"player",isOnline:!1,firstSeen:null,lastSeen:null,playTime:null,skinUrl:T(i)};b(h)}catch{w("error")}finally{u(!1)}},[]);return N.useEffect(()=>{},[a]),N.useEffect(()=>{let o=!1,d=null,k=0;async function i(){var c;if(!(!p||!j.current))try{v(!1),await new Promise((B,R)=>{const O=new window.Image;O.onload=()=>B(),O.onerror=R,O.src=p.skinUrl});const[{SkinViewer:s,IdleAnimation:h},m]=await Promise.all([P(()=>import("./skinview-DgIrehSQ.js").then(B=>B.s),[]),P(()=>import("./skinview-DgIrehSQ.js").then(B=>B.t),[])]);if(o)return;j.current.innerHTML="";const M=j.current.offsetWidth||200,G=j.current.offsetHeight||300;l.current=new s({width:M,height:G,skin:p.skinUrl,zoom:0}),j.current.appendChild(l.current.canvas),l.current.camera.position.set(0,1.5,42),l.current.camera.lookAt(new m.Vector3(0,.9,0));const x=new h;(c=l.current.animations)!=null&&c.add&&l.current.animations.add(x),x.speed=.6,x.play&&x.play();const S=()=>{o||!l.current||(k+=.003,l.current.playerObject&&(l.current.playerObject.rotation.y=k),typeof l.current.render=="function"&&l.current.render(),d=requestAnimationFrame(S))};v(!0),d=requestAnimationFrame(S)}catch{v(!0)}}return i(),()=>{var c;o=!0,d&&cancelAnimationFrame(d),(c=l.current)!=null&&c.dispose&&l.current.dispose(),v(!1)}},[p]),{state:{query:n,loading:y,error:g,player:p,skinReady:f},actions:{setQuery:r,search:t},utils:{formatDate:H,formatPlayTime:U,formatUUID:L},skinContainerRef:j}}const $={palette:["#5865F2","#fc8b4f","#85a2d5","#ffd166","#3ba779","#e86a92"],bg:"var(--bg-dark)",grid:"var(--stroke-base)",text:"var(--text-secondary)",title:"var(--text-primary)",value:"var(--text-primary)"},z=["SkyWars","Rush","HikaBrain","BedWars","UHC","BuildBattle","Duels","Other"];function Q(a){const n=new Set,r=[],y=u=>{n.has(u)||(n.add(u),r.push(u))};z.forEach(u=>{for(const g of a)if(g&&Object.prototype.hasOwnProperty.call(g,u)){y(u);break}});for(const u of a)Object.keys(u||{}).forEach(y);return r}function E(a,n){const r=Math.max(0,n.indexOf(a));return $.palette[r%$.palette.length]}function Y({data:a={},size:n=660,categories:r,center:y}){const u=Math.max(1,Object.values(a).reduce((o,d)=>o+(d||0),0));let g=0;const w=Object.entries(a),[p,b]=D.useState(null),f=n/2,v=f*.58,l=f,j=f,t=o=>{const d=(o-90)*Math.PI/180;return{x:l+f*Math.cos(d),y:j+f*Math.sin(d)}};return e.jsxs("svg",{style:{width:"100%",height:"auto"},viewBox:`0 0 ${n} ${n}`,role:"img","aria-label":"Donut chart",preserveAspectRatio:"xMidYMid meet",children:[w.map(([o,d])=>{const k=d||0,i=k/u*360,c=g,s=g+i;g=s;const h=t(c),m=t(s),M=s-c>180?1:0,G=`M ${l} ${j} L ${h.x} ${h.y} A ${f} ${f} 0 ${M} 1 ${m.x} ${m.y} Z`,x=(p==null?void 0:p.k)===o;return e.jsx("path",{d:G,fill:E(o,r),stroke:$.bg,strokeWidth:0,opacity:p?x?1:.6:1,onMouseEnter:()=>b({k:o,v:k}),onMouseLeave:()=>b(null)},o)}),e.jsx("circle",{cx:l,cy:j,r:v,fill:$.bg}),p||y?e.jsxs(e.Fragment,{children:[e.jsx("text",{x:l,y:j-2,textAnchor:"middle",fontSize:Math.max(12,n*.11),fontWeight:"800",fill:$.title,children:p?`${p.v}%`:y.value}),e.jsx("text",{x:l,y:j+14,textAnchor:"middle",fontSize:Math.max(9,n*.07),fill:$.text,children:p?p.k:y.label||""})]}):null]})}function Z({data:a={},height:n=260,barWidth:r=22,gap:y=26,categories:u,yTicks:g=[0,25,50,75,100],yLabel:w,valueSuffix:p="",showValues:b=!0}){const f=Object.entries(a),v=40,l=10,j=46,t=10,o=n-l-j,d=v+t+f.length*r+(f.length-1)*y,k=c=>v+c*(r+y),i=c=>l+(1-Math.max(0,Math.min(100,c))/100)*o;return e.jsxs("svg",{width:d,height:n,viewBox:`0 0 ${d} ${n}`,role:"img","aria-label":"Barres verticales",children:[e.jsx("line",{x1:v,x2:v,y1:l,y2:l+o,stroke:$.grid,strokeWidth:"1",opacity:"0.6"}),g.map(c=>{const s=i(c);return e.jsxs("g",{children:[e.jsx("line",{x1:v,x2:d-t,y1:s,y2:s,stroke:$.grid,strokeWidth:"1",opacity:"0.6"}),e.jsx("text",{x:v-6,y:s+4,textAnchor:"end",fontSize:"10",fill:$.text,children:c})]},c)}),w?e.jsx("text",{x:12,y:l+o/2,transform:`rotate(-90 12 ${l+o/2})`,fontSize:"11",fill:$.text,children:w}):null,f.map(([c,s],h)=>{const m=k(h),M=i(s),G=l+o-M,x=`${Math.round(s)}${p}`,S=Math.max(28,x.length*7+8);return e.jsxs("g",{children:[e.jsx("rect",{x:m,y:M,width:r,height:G,fill:E(c,u),rx:4}),b?e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:m+r/2-S/2,y:M-18,width:S,height:14,rx:7,fill:"var(--bg-dark)",stroke:"var(--bg-light)",strokeWidth:"1"}),e.jsx("text",{x:m+r/2,y:M-7,textAnchor:"middle",fontSize:"10",fill:$.value,children:x})]}):null,e.jsx("text",{x:m+r/2,y:n-10,textAnchor:"middle",fontSize:"11",fill:$.text,children:c})]},c)})]})}function X(){var c;const a=F(),n=s=>s?new Date(s).toLocaleDateString():a("stats-na","N/A"),r=s=>{if(s==null)return a("stats-na","N/A");const h=Math.floor(s),m=Math.round((s-h)*60);return`${h}h ${m}m`},{state:y,actions:u,skinContainerRef:g}=W(),{player:w,loading:p,error:b,query:f,skinReady:v}=y,{setQuery:l,search:j}=u,[t,o]=N.useState(null);N.useEffect(()=>{const s=w||null;if(!s){o(null);return}const h={username:s.displayName||s.username,role:s.role||"player",isOnline:!!s.isOnline,uuid:s.uuid,firstSeen:s.firstSeen||null,lastSeen:s.lastSeen||null,playTimeHours:typeof s.playTime=="number"?s.playTime/36e5:null,ggCoins:typeof s.ggCoins=="number"?s.ggCoins:0,playedGamesByType:s.playedGamesByType||{},timeByGamePct:s.timeByGamePct||{},winRateByGame:s.winRateByGame||{}};o(h)},[w]),_(),N.useEffect(()=>{const s=(f||"").trim();if(!s){o(null);return}const h=setTimeout(()=>{j(s)},450);return()=>clearTimeout(h)},[f]);const d=N.useMemo(()=>t?{games:Object.values(t.playedGamesByType||{}).reduce((s,h)=>s+(h||0),0)}:{games:0},[t]),k=N.useMemo(()=>Q([t==null?void 0:t.timeByGamePct,t==null?void 0:t.playedGamesByType,t==null?void 0:t.winRateByGame]),[t]),i=N.useMemo(()=>{if(!t)return null;const s=Object.values(t.playedGamesByType||{}).reduce((x,S)=>x+(S||0),0)||1,m=Object.entries(t.playedGamesByType||{}).reduce((x,[S,B])=>B>((x==null?void 0:x.v)||-1)?{k:S,v:B}:x,null)||{k:"-",v:0},M=Object.entries(t.winRateByGame||{}).reduce((x,[S,B])=>{var R;return x+(B||0)*(((R=t.playedGamesByType)==null?void 0:R[S])||0)},0)/s,G=Math.round(m.v/s*100);return{totalGames:s,topGame:m.k,topShare:G,weightedWR:Math.round(M||0)}},[t]);return e.jsx("section",{id:"stats",className:"player-stats section-auto-fade",children:e.jsxs("div",{className:"container stats-container",children:[e.jsx("div",{className:"stats-search",children:e.jsx("form",{className:"stats-search-form",onSubmit:s=>(s.preventDefault(),s.stopPropagation(),(f||"").trim()&&j(f),!1),children:e.jsxs("div",{className:"search-field",children:[e.jsx(C,{className:"search-icon","aria-hidden":!0}),e.jsx("input",{id:"player-search-input",className:"search-input",type:"text",placeholder:a("stats-search-input"),"aria-label":a("stats-search-input"),value:f,onChange:s=>l(s.target.value)})]})})}),t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid",children:[e.jsx("div",{className:"skin-card",children:e.jsx("div",{id:"player-skin-viewer-container",ref:g,className:`skin-fade-viewer${v?" ready":""}`,style:{width:"100%",height:"100%"}})}),e.jsxs("div",{className:"stats-col",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{className:`player-role ${t.role==="player"?"member":t.role} role-badge`,"data-lang":`role-${t.role==="player"?"member":t.role}`,children:a(`role-${t.role==="player"?"member":t.role}`,(t.role==="player"?"MEMBER":t.role).toUpperCase())}),e.jsx("h1",{className:"player-username",children:t.username})]}),e.jsxs("div",{className:"coins",children:[e.jsx("i",{className:"fas fa-coins","aria-hidden":!0}),e.jsx("span",{className:"coins-value",children:(t.ggCoins||0).toLocaleString()})]}),e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-calendar-plus","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-first-seen",children:a("stats-first-seen")}),e.jsx("div",{className:"kpi-value",children:n(t.firstSeen)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-calendar-check","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-last-seen",children:a("stats-last-seen")}),e.jsx("div",{className:"kpi-value",children:n(t.lastSeen)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-hourglass-half","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-play-time",children:a("stats-play-time")}),e.jsx("div",{className:"kpi-value",children:r(t.playTimeHours)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-gamepad","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-played-games",children:a("stats-played-games","Games played")}),e.jsx("div",{className:"kpi-value",children:d.games.toLocaleString()})]})]})]})]})]}),e.jsx("div",{className:"analytics-panel",children:e.jsxs("div",{className:"charts-grid",children:[e.jsx("div",{className:"chart-left",children:e.jsx("div",{className:"donut-wrap",children:e.jsx(Y,{data:t.timeByGamePct,size:360,categories:k,center:{value:Object.keys(t.timeByGamePct||{}).length>0?`${Math.max(...Object.values(t.timeByGamePct||{}))}%`:"—",label:Object.keys(t.playedGamesByType||{}).length>0?(Object.entries(t.playedGamesByType||{}).sort((s,h)=>h[1]-s[1])[0]||["-"])[0]:""}})})}),e.jsxs("div",{className:"chart-right",children:[e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-gamepad","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-played-games",children:a("stats-played-games","Games played")}),e.jsx("div",{className:"kpi-value",children:(c=i==null?void 0:i.totalGames)==null?void 0:c.toLocaleString()})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-trophy","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-global-winrate",children:a("stats-global-winrate","Global win rate")}),e.jsx("div",{className:"kpi-value",children:`${(i==null?void 0:i.weightedWR)??0}%`})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-chart-pie","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-most-played-mode",children:a("stats-most-played-mode","Most played mode")}),e.jsx("div",{className:"kpi-value",children:(i==null?void 0:i.topGame)||"-"}),e.jsx("div",{className:"kpi-hint",children:`${(i==null?void 0:i.topShare)??0}% ${a("stats-of-games","of games")}`})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-clock","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-play-time",children:a("stats-play-time")}),e.jsx("div",{className:"kpi-value",children:r(t.playTimeHours)})]})]})]}),e.jsx("div",{className:"chart-scroll-x",children:e.jsx(Z,{data:t.winRateByGame||{},categories:k,yLabel:null,valueSuffix:"",showValues:!1,barWidth:36,gap:24,height:260})})]})]})})]}):null,e.jsx("div",{className:"stats-note",children:p?e.jsx("p",{children:a("stats-loading")}):b==="notfound"?e.jsx("p",{children:a("stats-player-not-found")}):b==="empty"?e.jsx("p",{children:a("stats-empty-query")}):b==="error"?e.jsx("p",{children:a("stats-search-error")}):e.jsx("p",{children:a("stats-search-prompt")})})]})})}export{X as default};
