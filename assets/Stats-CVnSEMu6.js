import{r as T,j as e,a as Y,R as J}from"./vendor-react-cSbnrvtP.js";import{_ as Q,u as K,a as Z}from"./index-1AAztDHb.js";const U={EMPTY:"empty",NOT_FOUND:"notfound",ERROR:"error",RATE_LIMIT:"ratelimited"},W=(t,s)=>s;function X(t){return t?new Date(t).toLocaleDateString():W("stats-na","N/A")}function ee(t){if(t==null)return W("stats-na","N/A");let s=Math.floor(t/1e3),d=Math.floor(s/60),c=Math.floor(d/60);return s%=60,d%=60,`${c>0?c+"h ":""}${d>0?d+"m ":""}${s}s`.trim()}function te(t){return!t||t.length!==32?t||"N/A":`${t.substring(0,8)}-${t.substring(8,12)}-${t.substring(12,16)}-${t.substring(16,20)}-${t.substring(20)}`}const H="mcProfileCache",R={usernameToUuid:{},uuidToName:{}};try{if(typeof window<"u"&&typeof localStorage<"u"){const t=localStorage.getItem(H);t&&Object.assign(R,JSON.parse(t))}}catch{}function G(){try{typeof window<"u"&&typeof localStorage<"u"&&localStorage.setItem(H,JSON.stringify(R))}catch{}}async function ae(t){var d;const s=t.toLowerCase();if(R.usernameToUuid[s])return R.usernameToUuid[s];try{const c=await fetch(`https://playerdb.co/api/player/minecraft/${encodeURIComponent(s)}`);if(c.ok){const n=await c.json(),u=(d=n==null?void 0:n.data)==null?void 0:d.player;if(n!=null&&n.success&&(u!=null&&u.id)&&(u!=null&&u.username)){const r={uuid:u.id.replace(/-/g,""),name:u.username};return R.usernameToUuid[s]=r,R.uuidToName[r.uuid]=r.name,G(),r}}}catch{}try{const c=await fetch(`https://api.mojang.com/users/profiles/minecraft/${encodeURIComponent(s)}`);if(!c.ok)return null;const n=await c.json();if(n!=null&&n.id&&(n!=null&&n.name)){const u={uuid:n.id.replace(/-/g,""),name:n.name};return R.usernameToUuid[s]=u,R.uuidToName[u.uuid]=u.name,G(),u}}catch{}return null}async function se(t){const s=t.replace(/-/g,"");if(R.uuidToName[s])return{name:R.uuidToName[s]};try{const d=await fetch(`https://sessionserver.mojang.com/session/minecraft/profile/${s}`);if(!d.ok)return null;const c=await d.json();if(c!=null&&c.name)return R.uuidToName[s]=c.name,G(),{name:c.name}}catch{}return null}function _(t){return t?`https://crafatar.com/skins/${t.replace(/-/g,"")}?default=MHF_Steve&size=256`:"/img/player-skin.png"}function ne(t){const s=(t||"").replace(/-/g,"");return!s||!/^[0-9a-fA-F]{32}$/.test(s)?["/img/player-skin.png"]:[`https://mc-heads.net/skin/${s}`,`https://minotar.net/skin/${s}`,`https://crafatar.com/skins/${s}?size=256&default=MHF_Steve`,"/img/player-skin.png"]}async function re(t){for(const s of t)try{if(await new Promise(c=>{const n=new Image;let u=!1;const r=p=>{u||(u=!0,c(p))};n.onload=()=>r(!0),n.onerror=()=>r(!1),n.src=s,setTimeout(()=>r(!1),2e3)}))return s}catch{}return"/img/player-skin.png"}async function ie(t){return null}const le="/api-public",ce="seconds".toLowerCase();function oe(t){if(typeof t!="number")return null;switch(ce){case"ms":case"millisecond":case"milliseconds":return t;case"s":case"sec":case"second":case"seconds":return Math.round(t*1e3);case"m":case"min":case"minute":case"minutes":return Math.round(t*60*1e3);case"h":case"hr":case"hour":case"hours":return Math.round(t*3600*1e3);default:return Math.round(t*1e3)}}async function de(t){const s=encodeURIComponent(t),d=`${le}/profile/${s}`;try{let c=await fetch(d,{headers:{Accept:"application/json"}});if(c.status===429&&(await new Promise(y=>setTimeout(y,800)),c=await fetch(d,{headers:{Accept:"application/json"}})),c.status===429)return{rateLimited:!0};if(!c.ok)return null;const n=await c.json();if(!n)return null;const r=(n.uuid||"").toString().replace(/-/g,""),p=n.online_time,N=typeof p=="number"?oe(p):null;return{uuid:r&&/^[0-9a-fA-F]{32}$/.test(r)?r:null,displayName:n.username||t,role:(n.rank||"player").toLowerCase(),isOnline:!1,firstSeen:n.first_login||null,lastSeen:n.last_seen||null,playTime:N,wasBanned:n.was_banned===!0||typeof n.banned=="number"&&n.banned>0||!1,bannedAt:typeof n.banned=="number"?n.banned:void 0}}catch{return null}}function ue(t){const[s,d]=T.useState(""),[c,n]=T.useState(!1),[u,r]=T.useState(null),[p,N]=T.useState(null),[y,b]=T.useState(!1),i=T.useRef(null),x=T.useRef(null),a=T.useRef(0),v=T.useCallback(async g=>{const m=++a.current,j=(g??"").trim();if(!j){r(U.EMPTY),N(null);return}n(!0),r(null),b(!1);try{const l=await de(j);if(m!==a.current)return;if(l&&l.rateLimited){r(U.RATE_LIMIT);return}if(l&&l.uuid){N({...l,skinUrl:_(l.uuid)});return}let o=await ie(j);if(m!==a.current)return;if(o&&o.uuid){N({...o,skinUrl:_(o.uuid)});return}let h=null,w=j;const k=j.replace(/-/g,"");if(/^[0-9a-fA-F]{32}$/.test(k)){h=k;const f=await se(h);f!=null&&f.name&&(w=f.name)}else{const f=await ae(j);f&&(h=f.uuid,w=f.name)}if(m!==a.current)return;if(!h||!/^[0-9a-fA-F]{32}$/.test(h)){r(U.NOT_FOUND),N({uuid:null,displayName:j,role:"player",isOnline:!1,firstSeen:null,lastSeen:null,playTime:null,skinUrl:_(null)});return}N({uuid:h,displayName:w||j,role:"player",isOnline:!1,firstSeen:null,lastSeen:null,playTime:null,skinUrl:_(h)})}catch{r(U.ERROR)}finally{m===a.current&&n(!1)}},[]);return T.useEffect(()=>{},[t]),T.useEffect(()=>{let g=!1,m=null,j=0;const l={current:!0};let o=null;async function h(){var w;if(!(!p||!x.current))try{b(!1);const k=ne(p.uuid),f=await re(k),{SkinViewer:$,IdleAnimation:A}=await Q(async()=>{const{SkinViewer:B,IdleAnimation:O}=await import("./skinview-0_QnQS1A.js");return{SkinViewer:B,IdleAnimation:O}},[]);if(g)return;x.current.innerHTML="";const E=x.current.offsetWidth||200,q=x.current.offsetHeight||300;if(i.current=new $({width:E,height:q,skin:f,zoom:0}),x.current.appendChild(i.current.canvas),i.current.camera.position.set(0,1.5,42),typeof i.current.camera.lookAt=="function")try{i.current.camera.lookAt(0,.9,0)}catch{}const P=new A;(w=i.current.animations)!=null&&w.add&&i.current.animations.add(P),P.speed=.6,P.play&&P.play();const F=()=>{g||!i.current||(l.current&&(j+=.003),i.current.playerObject&&(i.current.playerObject.rotation.y=j),typeof i.current.render=="function"&&i.current.render(),m=requestAnimationFrame(F))};b(!0),m=requestAnimationFrame(F);const S=i.current.canvas;if(S){const B=()=>{l.current=!1},O=()=>{l.current=!0},C=()=>{l.current=!0},D=L=>{L.preventDefault()};S.addEventListener("mousedown",B,{passive:!0}),S.addEventListener("mouseup",O,{passive:!0}),S.addEventListener("mouseleave",C,{passive:!0}),S.addEventListener("touchstart",B,{passive:!0}),S.addEventListener("touchend",O,{passive:!0}),S.addEventListener("touchcancel",C,{passive:!0}),S.addEventListener("wheel",D,{passive:!1}),typeof ResizeObserver<"u"&&(o=new ResizeObserver(()=>{if(!i.current)return;const L=x.current.offsetWidth||200,I=x.current.offsetHeight||300;try{typeof i.current.setSize=="function"?i.current.setSize(L,I):typeof i.current.resize=="function"?i.current.resize(L,I):(i.current.width=L,i.current.height=I)}catch{}}),o.observe(x.current));const V=()=>{try{S.removeEventListener("mousedown",B)}catch{}try{S.removeEventListener("mouseup",O)}catch{}try{S.removeEventListener("mouseleave",C)}catch{}try{S.removeEventListener("touchstart",B)}catch{}try{S.removeEventListener("touchend",O)}catch{}try{S.removeEventListener("touchcancel",C)}catch{}try{S.removeEventListener("wheel",D)}catch{}};i.current._cleanupListeners=V}}catch{b(!0)}}return h(),()=>{var w,k;if(g=!0,m&&cancelAnimationFrame(m),(w=i.current)!=null&&w.dispose&&i.current.dispose(),(k=i.current)!=null&&k._cleanupListeners)try{i.current._cleanupListeners()}catch{}if(o)try{o.disconnect()}catch{}b(!1)}},[p]),{state:{query:s,loading:c,error:u,player:p,skinReady:y},actions:{setQuery:d,search:v},utils:{formatDate:X,formatPlayTime:ee,formatUUID:te},skinContainerRef:x}}const M={palette:["#5865F2","#fc8b4f","#85a2d5","#ffd166","#3ba779","#e86a92"],bg:"var(--bg-dark)",grid:"var(--stroke-base)",text:"var(--text-secondary)",title:"var(--text-primary)",value:"var(--text-primary)"},me=["SkyWars","Rush","HikaBrain","BedWars","UHC","BuildBattle","Duels","Other"];function fe(t){const s=new Set,d=[],c=n=>{s.has(n)||(s.add(n),d.push(n))};me.forEach(n=>{for(const u of t)if(u&&Object.prototype.hasOwnProperty.call(u,n)){c(n);break}});for(const n of t)Object.keys(n||{}).forEach(c);return d}function z(t,s){const d=Math.max(0,s.indexOf(t));return M.palette[d%M.palette.length]}function he({data:t={},size:s=660,categories:d,center:c}){const n=Math.max(1,Object.values(t).reduce((v,g)=>v+(g||0),0));let u=0;const r=Object.entries(t),[p,N]=J.useState(null),y=s/2,b=y*.58,i=y,x=y,a=v=>{const g=(v-90)*Math.PI/180;return{x:i+y*Math.cos(g),y:x+y*Math.sin(g)}};return e.jsxs("svg",{style:{width:"100%",height:"auto"},viewBox:`0 0 ${s} ${s}`,role:"img","aria-label":"Donut chart",preserveAspectRatio:"xMidYMid meet",children:[r.map(([v,g])=>{const m=g||0,j=m/n*360,l=u,o=u+j;u=o;const h=a(l),w=a(o),k=o-l>180?1:0,f=`M ${i} ${x} L ${h.x} ${h.y} A ${y} ${y} 0 ${k} 1 ${w.x} ${w.y} Z`,$=(p==null?void 0:p.k)===v;return e.jsx("path",{d:f,fill:z(v,d),stroke:M.bg,strokeWidth:0,opacity:p?$?1:.6:1,onMouseEnter:()=>N({k:v,v:m}),onMouseLeave:()=>N(null)},v)}),e.jsx("circle",{cx:i,cy:x,r:b,fill:M.bg}),p||c?e.jsxs(e.Fragment,{children:[e.jsx("text",{x:i,y:x-2,textAnchor:"middle",fontSize:Math.max(12,s*.11),fontWeight:"800",fill:M.title,children:p?`${p.v}%`:c.value}),e.jsx("text",{x:i,y:x+14,textAnchor:"middle",fontSize:Math.max(9,s*.07),fill:M.text,children:p?p.k:c.label||""})]}):null]})}function pe({data:t={},height:s=260,barWidth:d=22,gap:c=26,categories:n,yTicks:u=[0,25,50,75,100],yLabel:r,valueSuffix:p="",showValues:N=!0}){const y=Object.entries(t),b=40,i=10,x=46,a=10,v=s-i-x,g=420,m=Math.max(g,b+a+y.length*d+(y.length-1)*c),j=o=>b+o*(d+c),l=o=>i+(1-Math.max(0,Math.min(100,o))/100)*v;return e.jsxs("svg",{width:m,height:s,style:{minWidth:g,maxWidth:"100%"},viewBox:`0 0 ${m} ${s}`,role:"img","aria-label":"Barres verticales",children:[e.jsx("line",{x1:b,x2:b,y1:i,y2:i+v,stroke:M.grid,strokeWidth:"1",opacity:"0.6"}),u.map(o=>{const h=l(o);return e.jsxs("g",{children:[e.jsx("line",{x1:b,x2:m-a,y1:h,y2:h,stroke:M.grid,strokeWidth:"1",opacity:"0.6"}),e.jsx("text",{x:b-6,y:h+4,textAnchor:"end",fontSize:"10",fill:M.text,children:o})]},o)}),r?e.jsx("text",{x:12,y:i+v/2,transform:`rotate(-90 12 ${i+v/2})`,fontSize:"11",fill:M.text,children:r}):null,y.map(([o,h],w)=>{const k=j(w),f=l(h),$=i+v-f,A=`${Math.round(h)}${p}`,E=Math.max(28,A.length*7+8);return e.jsxs("g",{children:[e.jsx("rect",{x:k,y:f,width:d,height:$,fill:z(o,n),rx:4}),N?e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:k+d/2-E/2,y:f-18,width:E,height:14,rx:7,fill:"var(--bg-dark)",stroke:"var(--bg-light)",strokeWidth:"1"}),e.jsx("text",{x:k+d/2,y:f-7,textAnchor:"middle",fontSize:"10",fill:M.value,children:A})]}):null,e.jsx("text",{x:k+d/2,y:s-10,textAnchor:"middle",fontSize:"11",fill:M.text,children:o})]},o)})]})}function ve(){var j;const t=K(),s=l=>l?new Date(l).toLocaleDateString():t("stats-na","N/A"),d=l=>{if(l==null)return t("stats-na","N/A");const o=Math.floor(l),h=Math.round((l-o)*60);return`${o}h ${h}m`},{state:c,actions:n,skinContainerRef:u}=ue(),{player:r,loading:p,error:N,query:y,skinReady:b}=c,{setQuery:i,search:x}=n,a=r?{username:r.displayName||r.username,role:r.role||"player",isOnline:!!r.isOnline,uuid:r.uuid,firstSeen:r.firstSeen||null,lastSeen:r.lastSeen||null,playTimeHours:typeof r.playTime=="number"?r.playTime/36e5:null,ggCoins:typeof r.ggCoins=="number"?r.ggCoins:0,wasBanned:r.wasBanned===!0,bannedAt:typeof r.bannedAt=="number"?r.bannedAt:null,playedGamesByType:r.playedGamesByType||{},timeByGamePct:r.timeByGamePct||{},winRateByGame:r.winRateByGame||{}}:null;Z(),T.useEffect(()=>{const l=(y||"").trim();if(!l)return;const o=setTimeout(()=>{x(l)},450);return()=>clearTimeout(o)},[y]);const v=T.useMemo(()=>a?{games:Object.values(a.playedGamesByType||{}).reduce((l,o)=>l+(o||0),0)}:{games:0},[a]),g=T.useMemo(()=>fe([a==null?void 0:a.timeByGamePct,a==null?void 0:a.playedGamesByType,a==null?void 0:a.winRateByGame]),[a]),m=T.useMemo(()=>{if(!a)return null;const l=Object.values(a.playedGamesByType||{}).reduce((f,$)=>f+($||0),0)||1,h=Object.entries(a.playedGamesByType||{}).reduce((f,[$,A])=>A>((f==null?void 0:f.v)||-1)?{k:$,v:A}:f,null)||{k:"-",v:0},w=Object.entries(a.winRateByGame||{}).reduce((f,[$,A])=>{var E;return f+(A||0)*(((E=a.playedGamesByType)==null?void 0:E[$])||0)},0)/l,k=Math.round(h.v/l*100);return{totalGames:l,topGame:h.k,topShare:k,weightedWR:Math.round(w||0)}},[a]);return e.jsx("section",{id:"stats",className:"player-stats section-auto-fade",children:e.jsxs("div",{className:"container stats-container",children:[e.jsx("div",{className:"stats-search",style:a?void 0:{display:"flex",justifyContent:"center"},children:e.jsx("form",{className:"stats-search-form",onSubmit:l=>(l.preventDefault(),l.stopPropagation(),(y||"").trim()&&x(y),!1),children:e.jsxs("div",{className:"search-field search-field-right",children:[e.jsx("input",{id:"player-search-input",className:"search-input",type:"text",placeholder:t("stats-search-input"),"aria-label":t("stats-search-input"),value:y,onChange:l=>i(l.target.value)}),e.jsx(Y,{className:"search-icon","aria-hidden":!0})]})})}),a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid",children:[e.jsx("div",{className:"skin-card",children:e.jsx("div",{id:"player-skin-viewer-container",ref:u,className:`skin-fade-viewer${b?" ready":""}`,style:{width:"100%",height:"100%"}},(a==null?void 0:a.uuid)||"fallback")}),e.jsxs("div",{className:"stats-col",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{className:`player-role ${a.role==="player"?"member":a.role} role-badge`,"data-lang":`role-${a.role==="player"?"member":a.role}`,children:t(`role-${a.role==="player"?"member":a.role}`,(a.role==="player"?"MEMBER":a.role).toUpperCase())}),e.jsx("h1",{className:"player-username",children:a.username})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.65rem",flexWrap:"wrap"},children:[e.jsxs("div",{className:"coins",children:[e.jsx("i",{className:"fas fa-coins","aria-hidden":!0}),e.jsx("span",{className:"coins-value",children:(a.ggCoins||0).toLocaleString()})]}),Number.isFinite(a.bannedAt)&&a.bannedAt>0?e.jsxs("div",{className:"tag tag-danger",title:t("stats-banned","Banned"),children:[e.jsx("i",{className:"fas fa-ban","aria-hidden":!0}),e.jsx("span",{className:"tag-value",children:t("stats-banned","BANNED")})]}):a.wasBanned?e.jsxs("div",{className:"tag tag-danger",title:t("stats-was-banned","Was banned"),children:[e.jsx("i",{className:"fas fa-exclamation-triangle","aria-hidden":!0}),e.jsx("span",{className:"tag-value",children:t("stats-was-banned","WAS BANNED")})]}):null]}),e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-calendar-plus","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-first-seen",children:t("stats-first-seen")}),e.jsx("div",{className:"kpi-value",children:s(a.firstSeen)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-calendar-check","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-last-seen",children:t("stats-last-seen")}),e.jsx("div",{className:"kpi-value",children:s(a.lastSeen)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-hourglass-half","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-play-time",children:t("stats-play-time")}),e.jsx("div",{className:"kpi-value",children:d(a.playTimeHours)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-gamepad","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-played-games",children:t("stats-played-games","Games played")}),e.jsx("div",{className:"kpi-value",children:v.games.toLocaleString()})]})]})]})]})]}),e.jsx("div",{className:"analytics-panel",children:e.jsxs("div",{className:"bento-grid",children:[e.jsx("div",{className:"bento-donut",children:e.jsx("div",{className:"donut-wrap",children:e.jsx(he,{data:a.timeByGamePct,size:360,categories:g,center:{value:Object.keys(a.timeByGamePct||{}).length>0?`${Math.max(...Object.values(a.timeByGamePct||{}))}%`:"—",label:Object.keys(a.playedGamesByType||{}).length>0?(Object.entries(a.playedGamesByType||{}).sort((l,o)=>o[1]-l[1])[0]||["-"])[0]:""}})})}),e.jsxs("div",{className:"bento-right",children:[e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-gamepad","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-played-games",children:t("stats-played-games","Games played")}),e.jsx("div",{className:"kpi-value",children:(j=m==null?void 0:m.totalGames)==null?void 0:j.toLocaleString()})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-trophy","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-global-winrate",children:t("stats-global-winrate","Global win rate")}),e.jsx("div",{className:"kpi-value",children:`${(m==null?void 0:m.weightedWR)??0}%`})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-chart-pie","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-most-played-mode",children:t("stats-most-played-mode","Most played mode")}),e.jsx("div",{className:"kpi-value",children:(m==null?void 0:m.topGame)||"-"}),e.jsx("div",{className:"kpi-hint",children:`${(m==null?void 0:m.topShare)??0}% ${t("stats-of-games","of games")}`})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-clock","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-play-time",children:t("stats-play-time")}),e.jsx("div",{className:"kpi-value",children:d(a.playTimeHours)})]})]})]}),e.jsxs("div",{className:"vbar-card",children:[e.jsx("div",{className:"vbar-card-title","data-lang":"stats-winrate-by-game",children:t("stats-winrate-by-game","Winrate by game")}),e.jsx("div",{className:"chart-scroll-x",children:e.jsx(pe,{data:a.winRateByGame||{},categories:g,yLabel:null,valueSuffix:"",showValues:!1,barWidth:32,gap:28,height:260})})]})]})]})})]}):null,e.jsx("div",{className:"stats-note",children:p?e.jsx("p",{children:t("stats-loading")}):N==="ratelimited"?e.jsx("p",{children:t("stats-rate-limited","Too many requests. Please try again in a moment.")}):N==="notfound"?e.jsx("p",{children:t("stats-player-not-found")}):N==="empty"?e.jsx("p",{children:t("stats-empty-query")}):N==="error"?e.jsx("p",{children:t("stats-search-error")}):null})]})})}export{ve as default};
