import{r as b,j as e,a as F,R as H}from"./vendor-react-cSbnrvtP.js";import{_ as A,u as I,a as L}from"./index-B5R5GW5k.js";const U=(a,t)=>t;function W(a){return a?new Date(a).toLocaleDateString():U("stats-na","N/A")}function q(a){if(a==null)return U("stats-na","N/A");let t=Math.floor(a/1e3),c=Math.floor(t/60),d=Math.floor(c/60);return t%=60,c%=60,`${d>0?d+"h ":""}${c>0?c+"m ":""}${t}s`.trim()}function V(a){return!a||a.length!==32?a||"N/A":`${a.substring(0,8)}-${a.substring(8,12)}-${a.substring(12,16)}-${a.substring(16,20)}-${a.substring(20)}`}const E="mcProfileCache",T={usernameToUuid:{},uuidToName:{}};try{const a=localStorage.getItem(E);a&&Object.assign(T,JSON.parse(a))}catch{}function C(){try{localStorage.setItem(E,JSON.stringify(T))}catch{}}async function z(a){var c;const t=a.toLowerCase();if(T.usernameToUuid[t])return T.usernameToUuid[t];try{const d=await fetch(`https://playerdb.co/api/player/minecraft/${encodeURIComponent(t)}`);if(d.ok){const r=await d.json(),m=(c=r==null?void 0:r.data)==null?void 0:c.player;if(r!=null&&r.success&&(m!=null&&m.id)&&(m!=null&&m.username)){const l={uuid:m.id.replace(/-/g,""),name:m.username};return T.usernameToUuid[t]=l,T.uuidToName[l.uuid]=l.name,C(),l}}}catch{}try{const d=await fetch(`https://crafatar.com/users/${encodeURIComponent(t)}`);if(!d.ok)return null;const r=await d.json();if(r!=null&&r.id&&(r!=null&&r.name)){const m={uuid:r.id.replace(/-/g,""),name:r.name};return T.usernameToUuid[t]=m,T.uuidToName[m.uuid]=m.name,C(),m}}catch{}return null}async function J(a){const t=a.replace(/-/g,"");if(T.uuidToName[t])return{name:T.uuidToName[t]};try{const c=await fetch(`https://crafatar.com/users/${t}`);if(!c.ok)return null;const d=await c.json();if(d!=null&&d.name)return T.uuidToName[t]=d.name,C(),{name:d.name}}catch{}return null}function P(a){return a?`https://crafatar.com/skins/${a.replace(/-/g,"")}?default=MHF_Steve&size=256`:"img/player-skin.png"}async function Q(a){return null}function Y(a){const[t,c]=b.useState(""),[d,r]=b.useState(!1),[m,l]=b.useState(null),[x,w]=b.useState(null),[y,v]=b.useState(!1),o=b.useRef(null),j=b.useRef(null),s=b.useCallback(async f=>{const h=(f??"").trim();if(!h){l("empty"),w(null);return}r(!0),l(null),v(!1);try{let u=await Q(h);if(u&&u.uuid){w({...u,skinUrl:P(u.uuid)});return}let N=null,n=h;const i=h.replace(/-/g,"");if(/^[0-9a-fA-F]{32}$/.test(i)){N=i;const p=await J(N);p!=null&&p.name&&(n=p.name)}else{const p=await z(h);p&&(N=p.uuid,n=p.name)}if(!N||!/^[0-9a-fA-F]{32}$/.test(N)){l("notfound"),w({uuid:null,displayName:h,role:"player",isOnline:!1,firstSeen:null,lastSeen:null,playTime:null,skinUrl:P(null)});return}w({uuid:N,displayName:h,role:"player",isOnline:!1,firstSeen:null,lastSeen:null,playTime:null,skinUrl:P(N)})}catch{l("error")}finally{r(!1)}},[]);return b.useEffect(()=>{},[a]),b.useEffect(()=>{let f=!1,h=null,u=0;async function N(){var n;if(!(!x||!j.current))try{v(!1),await new Promise(S=>{const G=new window.Image;let R=!1;G.onload=()=>{R||(R=!0,setTimeout(S,16))},G.onerror=D=>{R||(R=!0,window&&window.console&&console.warn("Skin image failed to load",x.skinUrl,D),setTimeout(S,16))},G.src=x.skinUrl,G.complete&&!R&&(R=!0,setTimeout(S,16))}).catch(()=>{});const[{SkinViewer:i,IdleAnimation:p},O]=await Promise.all([A(()=>import("./skinview-DgIrehSQ.js").then(S=>S.s),[]),A(()=>import("./skinview-DgIrehSQ.js").then(S=>S.t),[])]);if(f)return;j.current.innerHTML="";const M=j.current.offsetWidth||200,g=j.current.offsetHeight||300;o.current=new i({width:M,height:g,skin:x.skinUrl,zoom:0}),j.current.appendChild(o.current.canvas),o.current.camera.position.set(0,1.5,42),o.current.camera.lookAt(new O.Vector3(0,.9,0));const k=new p;(n=o.current.animations)!=null&&n.add&&o.current.animations.add(k),k.speed=.6,k.play&&k.play();const B=()=>{f||!o.current||(u+=.003,o.current.playerObject&&(o.current.playerObject.rotation.y=u),typeof o.current.render=="function"&&o.current.render(),h=requestAnimationFrame(B))};v(!0),h=requestAnimationFrame(B)}catch{v(!0)}}return N(),()=>{var n;f=!0,h&&cancelAnimationFrame(h),(n=o.current)!=null&&n.dispose&&o.current.dispose(),v(!1)}},[x]),{state:{query:t,loading:d,error:m,player:x,skinReady:y},actions:{setQuery:c,search:s},utils:{formatDate:W,formatPlayTime:q,formatUUID:V},skinContainerRef:j}}const $={palette:["#5865F2","#fc8b4f","#85a2d5","#ffd166","#3ba779","#e86a92"],bg:"var(--bg-dark)",grid:"var(--stroke-base)",text:"var(--text-secondary)",title:"var(--text-primary)",value:"var(--text-primary)"},K=["SkyWars","Rush","HikaBrain","BedWars","UHC","BuildBattle","Duels","Other"];function Z(a){const t=new Set,c=[],d=r=>{t.has(r)||(t.add(r),c.push(r))};K.forEach(r=>{for(const m of a)if(m&&Object.prototype.hasOwnProperty.call(m,r)){d(r);break}});for(const r of a)Object.keys(r||{}).forEach(d);return c}function _(a,t){const c=Math.max(0,t.indexOf(a));return $.palette[c%$.palette.length]}function X({data:a={},size:t=660,categories:c,center:d}){const r=Math.max(1,Object.values(a).reduce((f,h)=>f+(h||0),0));let m=0;const l=Object.entries(a),[x,w]=H.useState(null),y=t/2,v=y*.58,o=y,j=y,s=f=>{const h=(f-90)*Math.PI/180;return{x:o+y*Math.cos(h),y:j+y*Math.sin(h)}};return e.jsxs("svg",{style:{width:"100%",height:"auto"},viewBox:`0 0 ${t} ${t}`,role:"img","aria-label":"Donut chart",preserveAspectRatio:"xMidYMid meet",children:[l.map(([f,h])=>{const u=h||0,N=u/r*360,n=m,i=m+N;m=i;const p=s(n),O=s(i),M=i-n>180?1:0,g=`M ${o} ${j} L ${p.x} ${p.y} A ${y} ${y} 0 ${M} 1 ${O.x} ${O.y} Z`,k=(x==null?void 0:x.k)===f;return e.jsx("path",{d:g,fill:_(f,c),stroke:$.bg,strokeWidth:0,opacity:x?k?1:.6:1,onMouseEnter:()=>w({k:f,v:u}),onMouseLeave:()=>w(null)},f)}),e.jsx("circle",{cx:o,cy:j,r:v,fill:$.bg}),x||d?e.jsxs(e.Fragment,{children:[e.jsx("text",{x:o,y:j-2,textAnchor:"middle",fontSize:Math.max(12,t*.11),fontWeight:"800",fill:$.title,children:x?`${x.v}%`:d.value}),e.jsx("text",{x:o,y:j+14,textAnchor:"middle",fontSize:Math.max(9,t*.07),fill:$.text,children:x?x.k:d.label||""})]}):null]})}function ee({data:a={},height:t=260,barWidth:c=22,gap:d=26,categories:r,yTicks:m=[0,25,50,75,100],yLabel:l,valueSuffix:x="",showValues:w=!0}){const y=Object.entries(a),v=40,o=10,j=46,s=10,f=t-o-j,h=420,u=Math.max(h,v+s+y.length*c+(y.length-1)*d),N=i=>v+i*(c+d),n=i=>o+(1-Math.max(0,Math.min(100,i))/100)*f;return e.jsxs("svg",{width:u,height:t,style:{minWidth:h,maxWidth:"100%"},viewBox:`0 0 ${u} ${t}`,role:"img","aria-label":"Barres verticales",children:[e.jsx("line",{x1:v,x2:v,y1:o,y2:o+f,stroke:$.grid,strokeWidth:"1",opacity:"0.6"}),m.map(i=>{const p=n(i);return e.jsxs("g",{children:[e.jsx("line",{x1:v,x2:u-s,y1:p,y2:p,stroke:$.grid,strokeWidth:"1",opacity:"0.6"}),e.jsx("text",{x:v-6,y:p+4,textAnchor:"end",fontSize:"10",fill:$.text,children:i})]},i)}),l?e.jsx("text",{x:12,y:o+f/2,transform:`rotate(-90 12 ${o+f/2})`,fontSize:"11",fill:$.text,children:l}):null,y.map(([i,p],O)=>{const M=N(O),g=n(p),k=o+f-g,B=`${Math.round(p)}${x}`,S=Math.max(28,B.length*7+8);return e.jsxs("g",{children:[e.jsx("rect",{x:M,y:g,width:c,height:k,fill:_(i,r),rx:4}),w?e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:M+c/2-S/2,y:g-18,width:S,height:14,rx:7,fill:"var(--bg-dark)",stroke:"var(--bg-light)",strokeWidth:"1"}),e.jsx("text",{x:M+c/2,y:g-7,textAnchor:"middle",fontSize:"10",fill:$.value,children:B})]}):null,e.jsx("text",{x:M+c/2,y:t-10,textAnchor:"middle",fontSize:"11",fill:$.text,children:i})]},i)})]})}function te(){var N;const a=I(),t=n=>n?new Date(n).toLocaleDateString():a("stats-na","N/A"),c=n=>{if(n==null)return a("stats-na","N/A");const i=Math.floor(n),p=Math.round((n-i)*60);return`${i}h ${p}m`},{state:d,actions:r,skinContainerRef:m}=Y(),{player:l,loading:x,error:w,query:y,skinReady:v}=d,{setQuery:o,search:j}=r,s=l?{username:l.displayName||l.username,role:l.role||"player",isOnline:!!l.isOnline,uuid:l.uuid,firstSeen:l.firstSeen||null,lastSeen:l.lastSeen||null,playTimeHours:typeof l.playTime=="number"?l.playTime/36e5:null,ggCoins:typeof l.ggCoins=="number"?l.ggCoins:0,playedGamesByType:l.playedGamesByType||{},timeByGamePct:l.timeByGamePct||{},winRateByGame:l.winRateByGame||{}}:null;L(),b.useEffect(()=>{const n=(y||"").trim();if(!n)return;const i=setTimeout(()=>{j(n)},450);return()=>clearTimeout(i)},[y]);const f=b.useMemo(()=>s?{games:Object.values(s.playedGamesByType||{}).reduce((n,i)=>n+(i||0),0)}:{games:0},[s]),h=b.useMemo(()=>Z([s==null?void 0:s.timeByGamePct,s==null?void 0:s.playedGamesByType,s==null?void 0:s.winRateByGame]),[s]),u=b.useMemo(()=>{if(!s)return null;const n=Object.values(s.playedGamesByType||{}).reduce((g,k)=>g+(k||0),0)||1,p=Object.entries(s.playedGamesByType||{}).reduce((g,[k,B])=>B>((g==null?void 0:g.v)||-1)?{k,v:B}:g,null)||{k:"-",v:0},O=Object.entries(s.winRateByGame||{}).reduce((g,[k,B])=>{var S;return g+(B||0)*(((S=s.playedGamesByType)==null?void 0:S[k])||0)},0)/n,M=Math.round(p.v/n*100);return{totalGames:n,topGame:p.k,topShare:M,weightedWR:Math.round(O||0)}},[s]);return e.jsx("section",{id:"stats",className:"player-stats section-auto-fade",children:e.jsxs("div",{className:"container stats-container",children:[e.jsx("div",{className:"stats-search",children:e.jsx("form",{className:"stats-search-form",onSubmit:n=>(n.preventDefault(),n.stopPropagation(),(y||"").trim()&&j(y),!1),children:e.jsxs("div",{className:"search-field search-field-right",children:[e.jsx("input",{id:"player-search-input",className:"search-input",type:"text",placeholder:a("stats-search-input"),"aria-label":a("stats-search-input"),value:y,onChange:n=>o(n.target.value)}),e.jsx(F,{className:"search-icon","aria-hidden":!0})]})})}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"stats-grid",children:[e.jsx("div",{className:"skin-card",children:e.jsx("div",{id:"player-skin-viewer-container",ref:m,className:`skin-fade-viewer${v?" ready":""}`,style:{width:"100%",height:"100%"}},(s==null?void 0:s.uuid)||"fallback")}),e.jsxs("div",{className:"stats-col",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[e.jsx("span",{className:`player-role ${s.role==="player"?"member":s.role} role-badge`,"data-lang":`role-${s.role==="player"?"member":s.role}`,children:a(`role-${s.role==="player"?"member":s.role}`,(s.role==="player"?"MEMBER":s.role).toUpperCase())}),e.jsx("h1",{className:"player-username",children:s.username})]}),e.jsxs("div",{className:"coins",children:[e.jsx("i",{className:"fas fa-coins","aria-hidden":!0}),e.jsx("span",{className:"coins-value",children:(s.ggCoins||0).toLocaleString()})]}),e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-calendar-plus","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-first-seen",children:a("stats-first-seen")}),e.jsx("div",{className:"kpi-value",children:t(s.firstSeen)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-calendar-check","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-last-seen",children:a("stats-last-seen")}),e.jsx("div",{className:"kpi-value",children:t(s.lastSeen)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-hourglass-half","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-play-time",children:a("stats-play-time")}),e.jsx("div",{className:"kpi-value",children:c(s.playTimeHours)})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-gamepad","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-played-games",children:a("stats-played-games","Games played")}),e.jsx("div",{className:"kpi-value",children:f.games.toLocaleString()})]})]})]})]})]}),e.jsx("div",{className:"analytics-panel",children:e.jsxs("div",{className:"bento-grid",children:[e.jsx("div",{className:"bento-donut",children:e.jsx("div",{className:"donut-wrap",children:e.jsx(X,{data:s.timeByGamePct,size:360,categories:h,center:{value:Object.keys(s.timeByGamePct||{}).length>0?`${Math.max(...Object.values(s.timeByGamePct||{}))}%`:"â€”",label:Object.keys(s.playedGamesByType||{}).length>0?(Object.entries(s.playedGamesByType||{}).sort((n,i)=>i[1]-n[1])[0]||["-"])[0]:""}})})}),e.jsxs("div",{className:"bento-right",children:[e.jsxs("div",{className:"kpi-grid",children:[e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-gamepad","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-played-games",children:a("stats-played-games","Games played")}),e.jsx("div",{className:"kpi-value",children:(N=u==null?void 0:u.totalGames)==null?void 0:N.toLocaleString()})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-trophy","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-global-winrate",children:a("stats-global-winrate","Global win rate")}),e.jsx("div",{className:"kpi-value",children:`${(u==null?void 0:u.weightedWR)??0}%`})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-chart-pie","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-most-played-mode",children:a("stats-most-played-mode","Most played mode")}),e.jsx("div",{className:"kpi-value",children:(u==null?void 0:u.topGame)||"-"}),e.jsx("div",{className:"kpi-hint",children:`${(u==null?void 0:u.topShare)??0}% ${a("stats-of-games","of games")}`})]})]}),e.jsxs("div",{className:"kpi-card",children:[e.jsx("div",{className:"kpi-icon",children:e.jsx("i",{className:"fas fa-clock","aria-hidden":!0})}),e.jsxs("div",{className:"kpi-meta",children:[e.jsx("div",{className:"kpi-label","data-lang":"stats-play-time",children:a("stats-play-time")}),e.jsx("div",{className:"kpi-value",children:c(s.playTimeHours)})]})]})]}),e.jsxs("div",{className:"vbar-card",children:[e.jsx("div",{className:"vbar-card-title","data-lang":"stats-winrate-by-game",children:a("stats-winrate-by-game","Winrate by game")}),e.jsx("div",{className:"chart-scroll-x",children:e.jsx(ee,{data:s.winRateByGame||{},categories:h,yLabel:null,valueSuffix:"",showValues:!1,barWidth:32,gap:28,height:260})})]})]})]})})]}):null,e.jsx("div",{className:"stats-note",children:x?e.jsx("p",{children:a("stats-loading")}):w==="notfound"?e.jsx("p",{children:a("stats-player-not-found")}):w==="empty"?e.jsx("p",{children:a("stats-empty-query")}):w==="error"?e.jsx("p",{children:a("stats-search-error")}):e.jsx("p",{children:a("stats-search-prompt")})})]})})}export{te as default};
